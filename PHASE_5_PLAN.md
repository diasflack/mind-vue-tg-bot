# Phase 5: Расширенная функциональность - План реализации

## Обзор

Phase 5 добавляет продвинутые функции для улучшения пользовательского опыта: связывание данных, уведомления, экспорт и комбинированная аналитика.

## Подфазы

### Phase 5.1: Привязка впечатлений к записям дня ✅ (уже частично реализовано)

**Статус:** Entry_date уже есть в БД, нужны handlers для управления

**Что добавить:**
- Функция `link_impression_to_entry()` - привязать впечатление к записи
- Функция `unlink_impression()` - отвязать впечатление
- Функция `get_entry_impressions()` - получить все впечатления для записи
- Отображение впечатлений в `/recent` и других командах просмотра
- Автоматическая привязка при создании записи в тот же день

**Команды:**
- `/link_impression <id> <дата>` - привязать впечатление к записи
- `/unlink_impression <id>` - отвязать впечатление

**Тесты:** ~8 тестов

**Оценка:** 1 день

---

### Phase 5.2: Уведомления по опросам

**Цель:** Напоминания о заполнении опросов

**Что добавить:**
- Таблица `user_survey_reminders` (template_id, chat_id, time, enabled)
- Функции для управления напоминаниями
- Интеграция с существующей системой уведомлений
- Проверка: не отправлять если уже заполнено сегодня

**Команды:**
- `/survey_reminders` - управление напоминаниями
- `/set_survey_reminder <название> <время>` - установить напоминание
- `/remove_survey_reminder <название>` - удалить напоминание

**Тесты:** ~10 тестов

**Оценка:** 1-2 дня

---

### Phase 5.3: Избранные опросы

**Цель:** Быстрый доступ к часто используемым опросам

**Что добавить:**
- Обновить таблицу `user_survey_preferences` (добавить is_favorite)
- Функции для управления избранным
- Отображение избранных первыми в списке

**Команды:**
- `/favorite_surveys` - список избранных
- `/add_favorite <название>` - добавить в избранное
- `/remove_favorite <название>` - удалить из избранного

**Тесты:** ~8 тестов

**Оценка:** 0.5-1 день

---

### Phase 5.4: Экспорт данных

**Цель:** Экспорт данных для анализа вне бота

**Что добавить:**
- Экспорт впечатлений в CSV
- Экспорт ответов на опросы в CSV
- Экспорт основных записей (уже есть?)
- JSON формат для всех данных
- Фильтрация по датам

**Команды:**
- `/export_impressions [--format csv|json] [--from DATE] [--to DATE]`
- `/export_surveys <название> [--format csv|json]`
- `/export_all [--format json]`

**Тесты:** ~12 тестов

**Оценка:** 1-2 дня

---

### Phase 5.5: Комбинированная аналитика

**Цель:** Корреляции между разными типами данных

**Что добавить:**
- Корреляция впечатлений с настроением (из entries)
- Корреляция опросов с метриками
- Например: влияние сна на настроение
- Например: тяга vs депрессия

**Команды:**
- `/combined_analytics` - общая аналитика
- `/correlations` - корреляции между метриками

**Тесты:** ~10 тестов

**Оценка:** 1-2 дня

---

## Приоритеты

**Обязательные (Must Have):**
1. Phase 5.1 - Привязка впечатлений (улучшает UX)
2. Phase 5.4 - Экспорт данных (важно для пользователей)

**Желательные (Nice to Have):**
3. Phase 5.3 - Избранные опросы
4. Phase 5.2 - Уведомления

**Опциональные (Optional):**
5. Phase 5.5 - Комбинированная аналитика (сложная, можно отложить)

---

## Порядок реализации

1. **Phase 5.1** - Привязка впечатлений (быстро, уже есть БД)
2. **Phase 5.4** - Экспорт данных (полезно, независимо)
3. **Phase 5.3** - Избранные опросы (быстро)
4. **Phase 5.2** - Уведомления (зависит от job queue)
5. **Phase 5.5** - Комбинированная аналитика (если останется время)

---

## Оценка времени

- Phase 5.1: 1 день
- Phase 5.4: 1-2 дня
- Phase 5.3: 0.5-1 день
- Phase 5.2: 1-2 дня
- Phase 5.5: 1-2 дня (опционально)

**Итого:** 4.5-8 дней для обязательных фаз

---

## Следующий шаг

Начинаем с **Phase 5.1: Привязка впечатлений к записям дня** - быстро реализуется, сразу улучшает UX.
