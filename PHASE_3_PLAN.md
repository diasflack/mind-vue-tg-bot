# Phase 3: Custom Survey Builder - –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

## –û–±–∑–æ—Ä

Phase 3 –¥–æ–±–∞–≤–ª—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –æ–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±–æ—Ç–∞. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ —É–¥–∞–ª—è—Ç—å —Å–≤–æ–∏ —à–∞–±–ª–æ–Ω—ã, –∞ —Ç–∞–∫–∂–µ —É–ø—Ä–∞–≤–ª—è—Ç—å –≤–æ–ø—Ä–æ—Å–∞–º–∏ –≤ –Ω–∏—Ö.

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
1. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —à–∞–±–ª–æ–Ω–æ–≤ –æ–ø—Ä–æ—Å–æ–≤
2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–æ–≤ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∫ —à–∞–±–ª–æ–Ω—É
3. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —à–∞–±–ª–æ–Ω–æ–≤ –∏ –≤–æ–ø—Ä–æ—Å–æ–≤
4. –£–¥–∞–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤ –∏ –≤–æ–ø—Ä–æ—Å–æ–≤
5. –ê–∫—Ç–∏–≤–∞—Ü–∏—è/–¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è —à–∞–±–ª–æ–Ω–æ–≤
6. –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
7. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: –º–∞–∫—Å–∏–º—É–º 20 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —à–∞–±–ª–æ–Ω–æ–≤ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
1. TDD –ø–æ–¥—Ö–æ–¥ - –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–∫—Ä—ã—Ç—ã —Ç–µ—Å—Ç–∞–º–∏
2. –ò–Ω—Ç—É–∏—Ç–∏–≤–Ω—ã–π –ø–æ—à–∞–≥–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
3. –ó–∞—â–∏—Ç–∞ –æ—Ç —É–¥–∞–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤
4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —à–∞–±–ª–æ–Ω–æ–≤

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ù–æ–≤—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è ConversationHandler:
```python
# –í src/config.py –¥–æ–±–∞–≤–∏—Ç—å:
CREATE_SURVEY_NAME = 28
CREATE_SURVEY_DESC = 29
ADD_QUESTION_TYPE = 30
ADD_QUESTION_TEXT = 31
ADD_QUESTION_CONFIG = 32
EDIT_SURVEY_SELECT = 33
EDIT_QUESTION_SELECT = 34
DELETE_SURVEY_CONFIRM = 35
```

### –ù–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã:
- `/create_survey` - –Ω–∞—á–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –æ–ø—Ä–æ—Å–∞
- `/edit_survey <–Ω–∞–∑–≤–∞–Ω–∏–µ>` - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –æ–ø—Ä–æ—Å
- `/delete_survey <–Ω–∞–∑–≤–∞–Ω–∏–µ>` - —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—Ä–æ—Å
- `/my_surveys` - —Å–ø–∏—Å–æ–∫ –º–æ–∏—Ö –æ–ø—Ä–æ—Å–æ–≤
- `/activate_survey <–Ω–∞–∑–≤–∞–Ω–∏–µ>` - –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –æ–ø—Ä–æ—Å
- `/deactivate_survey <–Ω–∞–∑–≤–∞–Ω–∏–µ>` - –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –æ–ø—Ä–æ—Å

## Phase 3.1: Create Template Handlers

### –§–∞–π–ª: `src/handlers/survey_create.py`

**–§—É–Ω–∫—Ü–∏–∏:**
```python
async def create_survey_start(update, context):
    """–ù–∞—á–∞–ª–æ —Å–æ–∑–¥–∞–Ω–∏—è –æ–ø—Ä–æ—Å–∞ - /create_survey"""
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ (max 20 —à–∞–±–ª–æ–Ω–æ–≤)
    # –ó–∞–ø—Ä–æ—Å –Ω–∞–∑–≤–∞–Ω–∏—è

async def receive_survey_name(update, context):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –æ–ø—Ä–æ—Å–∞"""
    # –í–∞–ª–∏–¥–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏—è
    # –ó–∞–ø—Ä–æ—Å –æ–ø–∏—Å–∞–Ω–∏—è

async def receive_survey_description(update, context):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è –æ–ø—Ä–æ—Å–∞"""
    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ –≤ –ë–î (is_active=False)
    # –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å

async def show_my_surveys(update, context):
    """–ü–æ–∫–∞–∑ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –æ–ø—Ä–æ—Å–æ–≤ - /my_surveys"""
    # –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ active/inactive
    # –ü–æ–∫–∞–∑ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –≤ –∫–∞–∂–¥–æ–º
```

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**
- –ù–∞–∑–≤–∞–Ω–∏–µ: 3-50 —Å–∏–º–≤–æ–ª–æ–≤, —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –û–ø–∏—Å–∞–Ω–∏–µ: –¥–æ 500 —Å–∏–º–≤–æ–ª–æ–≤
- –õ–∏–º–∏—Ç: –º–∞–∫—Å–∏–º—É–º 20 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —à–∞–±–ª–æ–Ω–æ–≤

### –¢–µ—Å—Ç—ã: `tests/test_survey_create.py`
- test_create_survey_start_success
- test_create_survey_exceeds_limit
- test_receive_name_valid
- test_receive_name_duplicate
- test_receive_name_too_short
- test_receive_name_too_long
- test_receive_description_valid
- test_show_my_surveys_empty
- test_show_my_surveys_multiple

**–û—Ü–µ–Ω–∫–∞:** ~12 —Ç–µ—Å—Ç–æ–≤

## Phase 3.2: Add Questions Handlers

### –§–∞–π–ª: `src/handlers/survey_questions.py`

**–§—É–Ω–∫—Ü–∏–∏:**
```python
async def add_question_start(update, context):
    """–ù–∞—á–∞–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–æ–ø—Ä–æ—Å–∞ –∫ —à–∞–±–ª–æ–Ω—É"""
    # –ü–æ–∫–∞–∑ —Ç–∏–ø–æ–≤ –≤–æ–ø—Ä–æ—Å–æ–≤ (inline keyboard)
    # text, numeric, yes_no, time, choice, scale

async def select_question_type(update, context):
    """–í—ã–±–æ—Ä —Ç–∏–ø–∞ –≤–æ–ø—Ä–æ—Å–∞"""
    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–∏–ø–∞ –≤ context
    # –ó–∞–ø—Ä–æ—Å —Ç–µ–∫—Å—Ç–∞ –≤–æ–ø—Ä–æ—Å–∞

async def receive_question_text(update, context):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –≤–æ–ø—Ä–æ—Å–∞"""
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª–∏–Ω—ã (10-500 —Å–∏–º–≤–æ–ª–æ–≤)
    # –ó–∞–ø—Ä–æ—Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –¥–ª—è —Ç–∏–ø–∞)

async def configure_numeric_question(update, context):
    """–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è numeric –≤–æ–ø—Ä–æ—Å–∞"""
    # –ó–∞–ø—Ä–æ—Å min/max –∑–Ω–∞—á–µ–Ω–∏–π

async def configure_choice_question(update, context):
    """–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è choice –≤–æ–ø—Ä–æ—Å–∞"""
    # –ó–∞–ø—Ä–æ—Å –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞
    # –ó–∞–ø—Ä–æ—Å single/multiple

async def configure_scale_question(update, context):
    """–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è scale –≤–æ–ø—Ä–æ—Å–∞"""
    # –ó–∞–ø—Ä–æ—Å min/max/step

async def save_question(update, context):
    """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞ –≤ –ë–î"""
    # –í–∞–ª–∏–¥–∞—Ü–∏—è order_num (–∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç)
    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ survey_questions
    # –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –¥–æ–±–∞–≤–∏—Ç—å –µ—â–µ –∏–ª–∏ –∑–∞–≤–µ—Ä—à–∏—Ç—å
```

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**
- –¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞: 10-500 —Å–∏–º–≤–æ–ª–æ–≤
- Numeric: min < max, —Ä–∞–∑—É–º–Ω—ã–µ –ø—Ä–µ–¥–µ–ª—ã
- Choice: 2-10 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤, –∫–∞–∂–¥—ã–π 1-100 —Å–∏–º–≤–æ–ª–æ–≤
- Scale: min < max, step > 0
- –ú–∞–∫—Å–∏–º—É–º 30 –≤–æ–ø—Ä–æ—Å–æ–≤ –≤ —à–∞–±–ª–æ–Ω–µ

### –¢–µ—Å—Ç—ã: `tests/test_survey_questions.py`
- test_add_question_to_template
- test_select_each_question_type (6 —Ç–µ—Å—Ç–æ–≤)
- test_receive_question_text_valid
- test_receive_question_text_too_short
- test_receive_question_text_too_long
- test_configure_numeric_valid
- test_configure_numeric_invalid_range
- test_configure_choice_valid
- test_configure_choice_too_few_options
- test_configure_choice_too_many_options
- test_configure_scale_valid
- test_configure_scale_invalid_step
- test_save_question_success
- test_question_limit_reached

**–û—Ü–µ–Ω–∫–∞:** ~20 —Ç–µ—Å—Ç–æ–≤

## Phase 3.3: Edit Template Handlers

### –§–∞–π–ª: `src/handlers/survey_edit.py`

**–§—É–Ω–∫—Ü–∏–∏:**
```python
async def edit_survey_start(update, context):
    """–ù–∞—á–∞–ª–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–ø—Ä–æ—Å–∞ - /edit_survey <name>"""
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞ —à–∞–±–ª–æ–Ω–∞
    # –ü–æ–∫–∞–∑ –º–µ–Ω—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
    #   - –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ
    #   - –ò–∑–º–µ–Ω–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ
    #   - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã
    #   - –ò–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤

async def edit_survey_name(update, context):
    """–ò–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –æ–ø—Ä–æ—Å–∞"""
    # –í–∞–ª–∏–¥–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω–æ–≤–æ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è
    # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ –ë–î

async def edit_survey_description(update, context):
    """–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è –æ–ø—Ä–æ—Å–∞"""

async def show_questions_for_edit(update, context):
    """–ü–æ–∫–∞–∑ —Å–ø–∏—Å–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"""
    # Inline keyboard —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏

async def edit_question(update, context):
    """–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞"""
    # –ü–æ–∫–∞–∑ —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    # –ó–∞–ø—Ä–æ—Å –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

async def reorder_questions(update, context):
    """–ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤"""
    # –ü–æ–∫–∞–∑ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ—Ä—è–¥–∫–∞
    # –ö–Ω–æ–ø–∫–∏ "–≤–≤–µ—Ä—Ö/–≤–Ω–∏–∑" –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞

async def delete_question(update, context):
    """–£–¥–∞–ª–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞ –∏–∑ —à–∞–±–ª–æ–Ω–∞"""
    # –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
    # –ü–µ—Ä–µ—Å—á–µ—Ç order_num
```

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**
- –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
- –ù–µ–ª—å–∑—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã (is_system=True)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∫–∞–∫ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏

### –¢–µ—Å—Ç—ã: `tests/test_survey_edit.py`
- test_edit_survey_as_owner
- test_edit_survey_not_owner
- test_edit_system_survey_forbidden
- test_edit_survey_name_valid
- test_edit_survey_name_duplicate
- test_edit_survey_description
- test_show_questions_for_edit
- test_edit_question_text
- test_edit_question_config
- test_reorder_questions_up
- test_reorder_questions_down
- test_delete_question_success
- test_delete_question_confirm_required

**–û—Ü–µ–Ω–∫–∞:** ~15 —Ç–µ—Å—Ç–æ–≤

## Phase 3.4: Delete Template Handlers

### –§–∞–π–ª: `src/handlers/survey_delete.py`

**–§—É–Ω–∫—Ü–∏–∏:**
```python
async def delete_survey_start(update, context):
    """–ù–∞—á–∞–ª–æ —É–¥–∞–ª–µ–Ω–∏—è –æ–ø—Ä–æ—Å–∞ - /delete_survey <name>"""
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞
    # –ó–∞–ø—Ä–æ—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

async def confirm_delete_survey(update, context):
    """–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è –æ–ø—Ä–æ—Å–∞"""
    # –£–¥–∞–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ (CASCADE —É–¥–∞–ª–∏—Ç –≤–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã)
    # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ

async def activate_survey(update, context):
    """–ê–∫—Ç–∏–≤–∞—Ü–∏—è –æ–ø—Ä–æ—Å–∞ - /activate_survey <name>"""
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã 1 –≤–æ–ø—Ä–æ—Å
    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ is_active=True

async def deactivate_survey(update, context):
    """–î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –æ–ø—Ä–æ—Å–∞ - /deactivate_survey <name>"""
    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ is_active=False
```

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**
- –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å
- –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã
- –ü—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤

### –¢–µ—Å—Ç—ã: `tests/test_survey_delete.py`
- test_delete_survey_as_owner
- test_delete_survey_not_owner
- test_delete_system_survey_forbidden
- test_confirm_delete_survey
- test_cancel_delete_survey
- test_activate_survey_with_questions
- test_activate_survey_no_questions
- test_deactivate_survey

**–û—Ü–µ–Ω–∫–∞:** ~10 —Ç–µ—Å—Ç–æ–≤

## Phase 3.5: Storage Extensions

### –§–∞–π–ª: `src/data/surveys_storage.py` (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ)

**–ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
```python
def create_user_template(conn, chat_id, name, description) -> int:
    """–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —à–∞–±–ª–æ–Ω–∞"""

def update_template(conn, template_id, chat_id, **updates) -> bool:
    """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ (–Ω–∞–∑–≤–∞–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ, is_active)"""

def delete_template(conn, template_id, chat_id) -> bool:
    """–£–¥–∞–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ (—Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü)"""

def get_user_templates(conn, chat_id, only_active=False) -> List[Dict]:
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""

def count_user_templates(conn, chat_id) -> int:
    """–ü–æ–¥—Å—á–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —à–∞–±–ª–æ–Ω–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""

def add_question_to_template(conn, template_id, chat_id, question_data) -> int:
    """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞ –∫ —à–∞–±–ª–æ–Ω—É"""

def update_question(conn, question_id, template_id, chat_id, **updates) -> bool:
    """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞ (—Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü —à–∞–±–ª–æ–Ω–∞)"""

def delete_question(conn, question_id, template_id, chat_id) -> bool:
    """–£–¥–∞–ª–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞"""

def reorder_questions(conn, template_id, chat_id, question_ids_order) -> bool:
    """–ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤"""
```

### –¢–µ—Å—Ç—ã: `tests/test_surveys_storage_extended.py`
- test_create_user_template
- test_update_template_name
- test_update_template_description
- test_update_template_is_active
- test_delete_template_as_owner
- test_delete_template_not_owner
- test_get_user_templates
- test_count_user_templates
- test_count_respects_limit
- test_add_question_to_template
- test_update_question_as_owner
- test_delete_question_as_owner
- test_reorder_questions

**–û—Ü–µ–Ω–∫–∞:** ~15 —Ç–µ—Å—Ç–æ–≤

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `src/bot.py`:
```python
from src.handlers import (
    ...,
    survey_create, survey_questions, survey_edit, survey_delete
)

survey_create.register(application)
survey_questions.register(application)
survey_edit.register(application)
survey_delete.register(application)
```

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `src/config.py`:
- –î–æ–±–∞–≤–∏—Ç—å 8 –Ω–æ–≤—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π
- –£–≤–µ–ª–∏—á–∏—Ç—å range() —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î:
–°—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Å—Ö–µ–º–∞ —É–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —à–∞–±–ª–æ–Ω—ã:
- `survey_templates.created_by` - chat_id –≤–ª–∞–¥–µ–ª—å—Ü–∞
- `survey_templates.is_system` - —Ñ–ª–∞–≥ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —à–∞–±–ª–æ–Ω–∞

## –û—Ü–µ–Ω–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è

| Phase | –§–∞–π–ª | –¢–µ—Å—Ç–æ–≤ |
|-------|------|--------|
| 3.1 | test_survey_create.py | 12 |
| 3.2 | test_survey_questions.py | 20 |
| 3.3 | test_survey_edit.py | 15 |
| 3.4 | test_survey_delete.py | 10 |
| 3.5 | test_surveys_storage_extended.py | 15 |
| **–ò—Ç–æ–≥–æ** | | **~72 —Ç–µ—Å—Ç–∞** |

## –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤—Å–µ–º —Ñ–∞–∑–∞–º

| –§–∞–∑–∞ | –¢–µ—Å—Ç–æ–≤ | –°—Ç–∞—Ç—É—Å |
|------|--------|--------|
| Phase 1: Impressions | 59 | ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∞ |
| Phase 2: Surveys | 65 | ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∞ |
| Phase 3: Custom Builder | 72 | üìã –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è |
| **–í—Å–µ–≥–æ** | **196** | |
| –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã | 220 | |
| **–ò—Ç–æ–≥–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ** | **416** | |

## –ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **Phase 3.1**: Create Template Handlers + —Ç–µ—Å—Ç—ã
2. **Phase 3.2**: Add Questions Handlers + —Ç–µ—Å—Ç—ã
3. **Phase 3.3**: Edit Template Handlers + —Ç–µ—Å—Ç—ã
4. **Phase 3.4**: Delete Template Handlers + —Ç–µ—Å—Ç—ã
5. **Phase 3.5**: Storage Extensions + —Ç–µ—Å—Ç—ã
6. **Integration**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –±–æ—Ç–∞
7. **Documentation**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ README

## –†–∏—Å–∫–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –†–∏—Å–∫–∏:
1. –°–ª–æ–∂–Ω–æ—Å—Ç—å UI –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –≤ Telegram
2. –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–æ–∂–Ω–æ–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –ú–∏—Ç–∏–≥–∞—Ü–∏—è:
1. –ü–æ—à–∞–≥–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏
2. –ü—Ä–∏–º–µ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –≤–æ–ø—Ä–æ—Å–∞
3. –í–∞–ª–∏–¥–∞—Ü–∏—è —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –æ–± –æ—à–∏–±–∫–∞—Ö

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- –ú–∞–∫—Å–∏–º—É–º 20 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —à–∞–±–ª–æ–Ω–æ–≤
- –ú–∞–∫—Å–∏–º—É–º 30 –≤–æ–ø—Ä–æ—Å–æ–≤ –≤ —à–∞–±–ª–æ–Ω–µ
- –ú–∞–∫—Å–∏–º—É–º 10 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –≤ choice –≤–æ–ø—Ä–æ—Å–µ

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–ª–∞–Ω–∞:
1. –ù–∞—á–∞—Ç—å —Å Phase 3.1 (Create Template Handlers)
2. –°–ª–µ–¥–æ–≤–∞—Ç—å TDD –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏
3. –ö–æ–º–º–∏—Ç–∏—Ç—å –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –ø–æ–¥—Ñ–∞–∑—ã
4. –ó–∞–ø—É—Å–∫–∞—Ç—å –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –∫–æ–º–º–∏—Ç–æ–º
