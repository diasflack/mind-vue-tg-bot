# Архитектура Telegram Mood Tracker Bot

**Версия:** 1.0
**Дата:** 2025-10-22
**Статус:** Stable

---

## Содержание

1. [Введение](#введение)
2. [Обзор системы](#обзор-системы)
3. [Архитектурные принципы](#архитектурные-принципы)
4. [Модули системы](#модули-системы)
   - [Обработчики команд (Handlers)](#обработчики-команд)
   - [Слой данных (Data Layer)](#слой-данных)
   - [Утилиты (Utils)](#утилиты)
   - [Визуализация (Visualization)](#визуализация)
   - [Аналитика (Analytics)](#аналитика)
5. [Потоки данных](#потоки-данных)
6. [Безопасность](#безопасность)
7. [Производительность](#производительность)
8. [Развертывание](#развертывание)

---

## Введение

**Telegram Mood Tracker Bot** - это Telegram-бот для ежедневного отслеживания психологического состояния с акцентом на приватность и удобство использования.

### Назначение

Бот помогает пользователям:
- Отслеживать 9 психологических показателей ежедневно
- Анализировать паттерны настроения и поведения
- Получать персонализированные инсайты
- Визуализировать динамику показателей
- Безопасно обмениваться данными с другими пользователями

### Ключевые характеристики

- **Язык:** Python 3.11+
- **Фреймворк:** python-telegram-bot v20+
- **База данных:** SQLite 3
- **Шифрование:** Fernet (AES-128)
- **Визуализация:** matplotlib, pandas
- **Архитектура:** Модульная, асинхронная

---

## Обзор системы

### Основные компоненты

```
┌─────────────────────────────────────────────────────────────┐
│                     Telegram Bot API                        │
└────────────────────────┬────────────────────────────────────┘
                         │
                         ▼
              ┌──────────────────────┐
              │   Application Layer  │
              │   (src/bot.py)       │
              └──────────┬───────────┘
                         │
        ┌────────────────┼────────────────┐
        │                │                │
        ▼                ▼                ▼
┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│   Handlers   │  │  Data Layer  │  │    Utils     │
│  (9 модулей) │  │  (3 модуля)  │  │  (4 модуля)  │
└──────────────┘  └──────────────┘  └──────────────┘
        │                │                │
        └────────────────┼────────────────┘
                         │
        ┌────────────────┼────────────────┐
        │                │                │
        ▼                ▼                ▼
┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│Visualization │  │  Analytics   │  │   Storage    │
│  (2 модуля)  │  │  (1 модуль)  │  │   (SQLite)   │
└──────────────┘  └──────────────┘  └──────────────┘
```

### Технологический стек

| Компонент | Технология | Версия |
|-----------|-----------|--------|
| Runtime | Python | 3.11+ |
| Bot Framework | python-telegram-bot | 20+ |
| Database | SQLite | 3 |
| Encryption | cryptography (Fernet) | latest |
| Data Processing | pandas | latest |
| Visualization | matplotlib | latest |
| Deployment | Docker | latest |

---

## Архитектурные принципы

### 1. Модульность

Каждый функциональный блок изолирован в отдельном модуле:
- **Handlers** - обработка команд пользователя
- **Data** - управление данными и шифрование
- **Utils** - вспомогательные функции
- **Visualization** - генерация графиков
- **Analytics** - анализ паттернов

### 2. Безопасность

- **Шифрование данных:** Каждый пользователь имеет уникальный ключ
- **KDF:** PBKDF2 с SHA256 (25000 итераций)
- **Алгоритм:** Fernet (симметричное шифрование AES-128)
- **Аутентификация:** Telegram ID как основа ключа

### 3. Асинхронность

Все операции с сетью выполняются асинхронно:
- Обработка команд
- Отправка сообщений
- Загрузка файлов

### 4. Кеширование

Многоуровневое кеширование для производительности:
- **Данные:** Кеш записей пользователей (30 минут)
- **Ключи:** Кеш ключей шифрования (1 час)
- **Графики:** Кеш визуализаций (24 часа)

### 5. Масштабируемость

- SQLite для начала (легкая миграция на PostgreSQL)
- Индексы БД для оптимизации запросов
- Асинхронные операции для параллелизма
- Процессы для CPU-интенсивных задач

---

## Статистика проекта

### Размер кодовой базы

| Категория | Модулей | Строк кода |
|-----------|---------|------------|
| Handlers | 9 | ~1400 |
| Data Layer | 3 | ~1000 |
| Utils | 4 | ~800 |
| Visualization | 2 | ~600 |
| Analytics | 1 | ~550 |
| Tests | 10+ | ~1500 |
| **Итого** | **29** | **~5850** |

### Функциональность

- **Команд бота:** 17
- **Отслеживаемых показателей:** 9
- **Типов графиков:** 4
- **Поддерживаемых часовых поясов:** 27
- **Форматов ввода дат:** 7

---

_Продолжение следует в следующих разделах..._
